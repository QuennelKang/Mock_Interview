<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Upload Resume | Mock Munchies</title>
    <script src="https://cdn.tailwindcss.com?plugins=typography"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.6.0/mammoth.browser.min.js"></script>
    <link rel="stylesheet" href="../css/style.css">
    <style>
        /* å¤ç”¨ main_page.html é£æ ¼çš„è¡¥å……æ ·å¼ */
        .serif { font-family: 'Times New Roman', Times, serif; }
        .btn-munchies {
            background-color: black;
            color: white;
            padding: 0.75rem 2rem;
            border-radius: 9999px;
            font-weight: 600;
            transition: all 0.3s;
        }
        .btn-munchies:hover {
            background-color: #333;
            transform: translateY(-2px);
        }
        .btn-secondary {
            background-color: white;
            color: black;
            border: 1px solid #e5e7eb;
            padding: 0.75rem 2rem;
            border-radius: 9999px;
            font-weight: 600;
            transition: all 0.3s;
        }
        .btn-secondary:hover {
            background-color: #f9fafb;
            border-color: #d1d5db;
        }
        .input-field {
            width: 100%;
            padding: 1rem;
            border: 1px solid #e5e7eb;
            border-radius: 0.75rem;
            outline: none;
            transition: border-color 0.3s;
        }
        .input-field:focus {
            border-color: black;
        }
        .label-text {
            display: block;
            margin-bottom: 0.5rem;
            font-size: 0.875rem;
            font-weight: 600;
            color: #374151;
        }
    </style>
</head>
<body class="antialiased bg-white text-gray-900 flex flex-col min-h-screen">

    <!-- é¡¶éƒ¨å¯¼èˆªæ  (ä¿æŒä¸€è‡´) -->
    <nav class="flex justify-between items-center px-8 md:px-16 py-8 border-b border-gray-100">
        <a href="../main_page.html" class="text-2xl font-bold tracking-tighter serif">Mock<span class="text-gray-400">.</span>Munchies</a>
        <div class="hidden md:flex space-x-12 text-sm uppercase tracking-widest font-medium items-center">
            <a href="../main_page.html" class="hover:text-gray-500 transition">è¿”å›é¦–é¡µ</a>
            <a href="#" class="hover:text-gray-500 transition">ç»ƒä¹ ä¸­å¿ƒ</a>
        </div>
    </nav>

    <!-- ä¸»ä½“å†…å®¹ -->
    <main class="flex-grow max-w-4xl mx-auto w-full px-8 py-12">
        
        <div class="text-center mb-12">
            <span class="text-xs uppercase tracking-[0.3em] text-gray-400 font-bold">Preparation</span>
            <h1 class="text-4xl serif mt-4 mb-4">å®Œå–„é¢è¯•ä¿¡æ¯</h1>
            <p class="text-gray-500 font-light">ä¸Šä¼ ç®€å†å¹¶å¡«å†™èŒä½è¯¦æƒ…ï¼Œè®© AI ä¸ºæ‚¨å®šåˆ¶ä¸“å±é¢è¯•ä½“éªŒã€‚</p>
        </div>

        <!-- è¡¨å•åŒºåŸŸ -->
        <div id="formSection" class="space-y-10 animate-fade-in">
            
            <!-- 1. ç®€å†ä¸Šä¼  -->
            <section class="bg-gray-50 p-8 rounded-2xl border border-gray-100">
                <h2 class="text-xl font-bold mb-6 flex items-center">
                    <span class="w-8 h-8 bg-black text-white rounded-full flex items-center justify-center text-sm mr-3">1</span>
                    ä¸Šä¼ ç®€å†
                </h2>
                
                <div class="border-2 border-dashed border-gray-300 rounded-xl p-10 text-center hover:bg-gray-100 transition relative cursor-pointer" id="dropZone">
                    <input type="file" id="resumeInput" class="absolute inset-0 w-full h-full opacity-0 cursor-pointer" 
                           accept=".pdf,.doc,.docx,.jpeg,.png,.bmp,.txt">
                    <div class="text-4xl mb-4">ğŸ“„</div>
                    <p class="font-medium text-lg mb-2">ç‚¹å‡»æˆ–æ‹–æ‹½ä¸Šä¼ ç®€å†</p>
                    <p class="text-gray-400 text-sm">æ”¯æŒ PDF, DOC, DOCX, JPEG, PNG, BMP, TXT</p>
                    <p id="fileNameDisplay" class="mt-4 text-blue-600 font-medium hidden"></p>
                </div>
                <p id="uploadError" class="text-red-500 text-sm mt-2 hidden"></p>
            </section>

            <!-- 2. èŒä½ä¿¡æ¯ -->
            <section class="bg-white p-0">
                <h2 class="text-xl font-bold mb-6 flex items-center">
                    <span class="w-8 h-8 bg-black text-white rounded-full flex items-center justify-center text-sm mr-3">2</span>
                    èŒä½è¯¦æƒ…
                </h2>
                
                <div class="grid md:grid-cols-2 gap-6 mb-6">
                    <div>
                        <label class="label-text">å…¬å¸åç§°</label>
                        <input type="text" id="companyName" class="input-field" placeholder="ä¾‹å¦‚ï¼šMunchies Tech">
                    </div>
                    <div>
                        <label class="label-text">èŒä½åç§° <span class="text-red-500">*</span></label>
                        <input type="text" id="position" class="input-field" placeholder="ä¾‹å¦‚ï¼šé«˜çº§å‰ç«¯å·¥ç¨‹å¸ˆ">
                    </div>
                </div>

                <div class="mb-6">
                    <label class="label-text">å…¬å¸ç®€ä»‹</label>
                    <textarea id="companyDesc" rows="3" class="input-field resize-none" placeholder="ç®€å•ä»‹ç»å…¬å¸èƒŒæ™¯..."></textarea>
                </div>

                <div class="mb-6">
                    <label class="label-text">èŒä½æè¿° (JD) <span class="text-red-500">*</span></label>
                    <textarea id="jobDesc" rows="5" class="input-field resize-none" placeholder="è¾“å…¥èŒä½çš„ä¸»è¦èŒè´£..."></textarea>
                </div>

                <div class="mb-6">
                    <label class="label-text">èŒä½è¦æ±‚</label>
                    <textarea id="jobReq" rows="5" class="input-field resize-none" placeholder="è¾“å…¥ä»»èŒèµ„æ ¼è¦æ±‚..."></textarea>
                </div>
            </section>

            <div class="flex justify-end pt-6">
                <button onclick="goToPreview()" class="btn-munchies">ä¸‹ä¸€æ­¥ï¼šé¢„è§ˆä¿¡æ¯ â†’</button>
            </div>
        </div>

        <!-- é¢„è§ˆåŒºåŸŸ (é»˜è®¤éšè—) -->
        <div id="previewSection" class="hidden space-y-8 animate-fade-in">
            <div class="bg-blue-50 border border-blue-100 p-6 rounded-xl flex items-start gap-4">
                <div class="text-blue-500 text-xl">â„¹ï¸</div>
                <div>
                    <h3 class="font-bold text-blue-900 mb-1">éšç§å®‰å…¨æç¤º</h3>
                    <p class="text-blue-800 text-sm leading-relaxed">
                        åœ¨ä¿å­˜ä¹‹å‰ï¼Œè¯·ç¡®ä¿æ‚¨çš„ç®€å†é¢„è§ˆä¸­å·²å»é™¤ <span class="font-bold">å§“åã€ç”µè¯ã€é‚®ç®±åœ°å€</span> ç­‰ä¸ªäººæ•æ„Ÿéšç§ä¿¡æ¯ã€‚
                        è¿™æ˜¯ä¸ºäº†ä¿æŠ¤æ‚¨çš„ä¸ªäººæ•°æ®å®‰å…¨ã€‚
                    </p>
                </div>
            </div>

            <div class="bg-white border border-gray-200 rounded-2xl p-8 shadow-sm">
                <h2 class="text-2xl serif mb-8 border-b pb-4">ä¿¡æ¯ç¡®è®¤</h2>
                
                <div class="space-y-6">
                    <div class="grid grid-cols-3 gap-4">
                        <span class="text-gray-500 font-medium">ç®€å†æ–‡ä»¶</span>
                        <div class="col-span-2 font-medium" id="previewResume">æœªä¸Šä¼ </div>
                    </div>
                    
                    <div class="grid grid-cols-3 gap-4">
                        <span class="text-gray-500 font-medium">å…¬å¸åç§°</span>
                        <div class="col-span-2" id="previewCompany">--</div>
                    </div>
                    
                    <div class="grid grid-cols-3 gap-4">
                        <span class="text-gray-500 font-medium">èŒä½åç§°</span>
                        <div class="col-span-2 font-bold" id="previewPosition">--</div>
                    </div>

                    <div class="grid grid-cols-3 gap-4">
                        <span class="text-gray-500 font-medium">å…¬å¸ç®€ä»‹</span>
                        <div class="col-span-2 text-gray-700 leading-relaxed" id="previewCompanyDesc">--</div>
                    </div>

                    <div class="grid grid-cols-3 gap-4">
                        <span class="text-gray-500 font-medium">èŒä½æè¿°</span>
                        <div class="col-span-2 text-gray-700 leading-relaxed whitespace-pre-wrap" id="previewJobDesc">--</div>
                    </div>

                    <div class="grid grid-cols-3 gap-4">
                        <span class="text-gray-500 font-medium">èŒä½è¦æ±‚</span>
                        <div class="col-span-2 text-gray-700 leading-relaxed whitespace-pre-wrap" id="previewJobReq">--</div>
                    </div>
                </div>
            </div>

            <div class="flex justify-between pt-6">
                <button onclick="backToEdit()" class="btn-secondary">â† è¿”å›ç¼–è¾‘</button>
                <button onclick="saveData()" class="btn-munchies bg-green-600 hover:bg-green-700 border-transparent">ç¡®è®¤ä¿å­˜å¹¶ä¸Šä¼  âœ“</button>
            </div>
        </div>

    </main>

    <!-- é¡µè„š -->
    <footer class="py-12 border-t border-gray-50 mt-auto">
        <div class="max-w-7xl mx-auto px-8 text-center text-sm text-gray-400 uppercase tracking-widest">
            Â© 2026 Mock Munchies
        </div>
    </footer>

<script>
    // å…è®¸çš„æ–‡ä»¶æ‰©å±•å
    const ALLOWED_EXTENSIONS = ['pdf', 'doc', 'docx', 'jpeg', 'png', 'bmp', 'txt'];

    const resumeInput = document.getElementById('resumeInput');
    const fileNameDisplay = document.getElementById('fileNameDisplay');
    const uploadError = document.getElementById('uploadError');

    // ç›‘å¬æ–‡ä»¶ä¸Šä¼ 
    resumeInput.addEventListener('change', function(e) {
        const file = e.target.files[0];
        uploadError.classList.add('hidden');
        fileNameDisplay.classList.add('hidden');

        if (!file) return;

        const fileExt = file.name.split('.').pop().toLowerCase();
        
        if (!ALLOWED_EXTENSIONS.includes(fileExt)) {
            uploadError.textContent = `æ ¼å¼é”™è¯¯ï¼šä¸æ”¯æŒ .${fileExt} æ ¼å¼ã€‚è¯·ä¸Šä¼  PDF, DOC, DOCX, JPEG, PNG, BMP æˆ– TXTã€‚`;
            uploadError.classList.remove('hidden');
            this.value = ''; // æ¸…ç©ºè¾“å…¥
            console.log('File upload failed: Invalid format', file.name);
            return;
        }

        // ä¸Šä¼ æˆåŠŸé€»è¾‘
        fileNameDisplay.textContent = `å·²é€‰æ‹©æ–‡ä»¶: ${file.name} (${(file.size / 1024).toFixed(1)} KB)`;
        fileNameDisplay.classList.remove('hidden');
        
        console.log('--- Resume Uploaded ---');
        console.log('File Name:', file.name);
        console.log('File Size:', file.size, 'bytes');
        console.log('File Type:', file.type);
        console.log('-----------------------');
    });

    // åˆ‡æ¢åˆ°é¢„è§ˆé¡µ
    async function goToPreview() {
        // è·å–å€¼
        const companyName = document.getElementById('companyName').value.trim();
        const companyDesc = document.getElementById('companyDesc').value.trim();
        const position = document.getElementById('position').value.trim();
        const jobDesc = document.getElementById('jobDesc').value.trim();
        const jobReq = document.getElementById('jobReq').value.trim();
        const file = resumeInput.files[0];

        // åˆ‡æ¢æ˜¾ç¤º (å…ˆåˆ‡æ¢ä»¥å±•ç¤ºåŠ è½½çŠ¶æ€)
        document.getElementById('formSection').classList.add('hidden');
        document.getElementById('previewSection').classList.remove('hidden');
        window.scrollTo(0, 0);
        
        document.getElementById('previewCompany').textContent = companyName || 'æœªå¡«å†™';
        document.getElementById('previewCompanyDesc').textContent = companyDesc || 'æœªå¡«å†™';
        document.getElementById('previewPosition').textContent = position || 'æœªå¡«å†™';
        document.getElementById('previewJobDesc').textContent = jobDesc || 'æœªå¡«å†™';
        document.getElementById('previewJobReq').textContent = jobReq || 'æœªå¡«å†™';

        // å¡«å……é¢„è§ˆ
        const previewContainer = document.getElementById('previewResume');
        previewContainer.innerHTML = '<p class="text-gray-400 text-sm animate-pulse">æ­£åœ¨åŠ è½½é¢„è§ˆ...</p>'; 
        previewContainer.className = 'col-span-2'; 

        if (!file) {
            previewContainer.textContent = 'æœªä¸Šä¼  (å°†åœ¨ä¿å­˜æ—¶è¢«æ‹¦æˆª)';
            previewContainer.classList.add('font-medium', 'text-red-500');
        } else {
            const fileExt = file.name.split('.').pop().toLowerCase();
            
            try {
                if (['jpg', 'jpeg', 'png', 'bmp'].includes(fileExt)) {
                    const img = document.createElement('img');
                    img.src = URL.createObjectURL(file);
                    img.className = 'max-w-full h-auto max-h-96 object-contain border rounded-lg shadow-sm';
                    previewContainer.innerHTML = '';
                    previewContainer.appendChild(img);
                } else if (fileExt === 'pdf') {
                    const iframe = document.createElement('iframe');
                    iframe.src = URL.createObjectURL(file);
                    iframe.className = 'w-full h-96 border rounded-lg bg-gray-50 shadow-sm';
                    previewContainer.innerHTML = '';
                    previewContainer.appendChild(iframe);
                } else if (fileExt === 'txt') {
                    const text = await file.text();
                    const pre = document.createElement('pre');
                    pre.className = 'whitespace-pre-wrap font-mono text-sm bg-gray-50 p-4 rounded-lg max-h-96 overflow-y-auto border shadow-sm';
                    pre.textContent = text;
                    previewContainer.innerHTML = '';
                    previewContainer.appendChild(pre);
                } else if (fileExt === 'docx') {
                    const arrayBuffer = await file.arrayBuffer();
                    const result = await mammoth.convertToHtml({arrayBuffer: arrayBuffer});
                    const div = document.createElement('div');
                    div.className = 'prose prose-sm max-w-none bg-white p-4 rounded-lg max-h-96 overflow-y-auto border shadow-sm';
                    div.innerHTML = result.value;
                    previewContainer.innerHTML = '';
                    previewContainer.appendChild(div);
                } else {
                    // DOC æˆ–å…¶ä»–
                    previewContainer.innerHTML = `
                        <div class="flex items-center space-x-3 text-gray-500 bg-gray-50 p-4 rounded-lg border">
                            <span class="text-2xl">ğŸ“„</span>
                            <div>
                                <p class="font-medium text-gray-900">${file.name}</p>
                                <p class="text-xs mt-1">è¯¥æ ¼å¼ (.${fileExt}) æš‚ä¸æ”¯æŒåœ¨çº¿å†…å®¹é¢„è§ˆï¼Œè¯·ç¡®ä¿æ–‡ä»¶æ— è¯¯ã€‚</p>
                            </div>
                        </div>
                    `;
                }
            } catch (e) {
                console.error('Preview error:', e);
                previewContainer.innerHTML = `
                    <p class="text-red-500 text-sm">
                        é¢„è§ˆç”Ÿæˆå¤±è´¥: ${e.message}<br>
                        <span class="text-gray-400 text-xs">æ–‡ä»¶å·²é€‰ä¸­ (${file.name})ï¼Œå¯ç»§ç»­ä¿å­˜ã€‚</span>
                    </p>
                `;
            }
        }
    }

    // è¿”å›ç¼–è¾‘
    function backToEdit() {
        document.getElementById('previewSection').classList.add('hidden');
        document.getElementById('formSection').classList.remove('hidden');
        window.scrollTo(0, 0);
    }

    // ä¿å­˜æ•°æ®
    function saveData() {
        const position = document.getElementById('position').value.trim();
        const jobDesc = document.getElementById('jobDesc').value.trim();
        const file = resumeInput.files[0];

        // å¿…å¡«é¡¹éªŒè¯
        let errors = [];
        if (!file) errors.push('è¯·ä¸Šä¼ ç®€å†æ–‡ä»¶');
        if (!position) errors.push('è¯·å¡«å†™èŒä½åç§°');
        if (!jobDesc) errors.push('è¯·å¡«å†™èŒä½æè¿°');

        if (errors.length > 0) {
            alert('æ— æ³•ä¿å­˜ï¼Œè¯·è¡¥å……ä»¥ä¸‹å¿…å¡«é¡¹ï¼š\n\n' + errors.join('\n'));
            return;
        }

        // æ¨¡æ‹Ÿä¿å­˜
        const formData = {
            resume: file.name,
            company: document.getElementById('companyName').value.trim(),
            companyDescription: document.getElementById('companyDesc').value.trim(),
            position: position,
            jobDescription: jobDesc,
            jobRequirements: document.getElementById('jobReq').value.trim()
        };

        console.log('=== Final Data Saved ===');
        console.log(formData);
        console.log('========================');

        alert('ä¿å­˜æˆåŠŸï¼\nä¿¡æ¯å·²ä¸Šä¼ è‡³åå° (æŸ¥çœ‹ Console è¯¦æƒ…)ã€‚');
        // location.href = '../main_page.html'; // å¯é€‰ï¼šè·³è½¬å›é¦–é¡µ
    }
</script>
</body>
</html>