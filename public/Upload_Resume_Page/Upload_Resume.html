<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Upload Resume | Mock Munchies</title>
    <script src="https://cdn.tailwindcss.com?plugins=typography"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.6.0/mammoth.browser.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script src='https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js'></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script>
        // é…ç½® PDF.js worker
        if (typeof pdfjsLib !== 'undefined') {
            pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
        } else {
            console.warn('PDF.js library not loaded yet.');
        }
    </script>
    <link rel="stylesheet" href="../css/style.css">
    <style>
        /* å¤ç”¨ main_page.html é£æ ¼çš„è¡¥å……æ ·å¼ */
        .serif { font-family: 'Times New Roman', Times, serif; }

        /* Load Screen Styles Integration */
        @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;1,400&display=swap');
        .ls-serif { font-family: 'Playfair+Display', serif; }
        
        .bg-blur-image {
            background-image: url('https://images.unsplash.com/photo-1497032628192-86f99bcd76bc?q=80&w=2070&auto=format&fit=crop');
            background-size: cover;
            background-position: center;
            filter: grayscale(100%) brightness(0.9);
        }

        /* è¿›åº¦æ¡åŠ¨ç”»å¹³æ»‘å¤„ç† */
        #progress-bar {
            transition: width 0.4s cubic-bezier(0.1, 0.7, 1.0, 0.1);
        }

        @keyframes fade-in-up {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fau { animation: fade-in-up 0.8s ease-out forwards; }

        .btn-munchies {
            background-color: black;
            color: white;
            padding: 0.75rem 2rem;
            border-radius: 9999px;
            font-weight: 600;
            transition: all 0.3s;
        }
        .btn-munchies:hover {
            background-color: #333;
            transform: translateY(-2px);
        }
        .btn-secondary {
            background-color: white;
            color: black;
            border: 1px solid #e5e7eb;
            padding: 0.75rem 2rem;
            border-radius: 9999px;
            font-weight: 600;
            transition: all 0.3s;
        }
        .btn-secondary:hover {
            background-color: #f9fafb;
            border-color: #d1d5db;
        }
        .input-field {
            width: 100%;
            padding: 1rem;
            border: 1px solid #e5e7eb;
            border-radius: 0.75rem;
            outline: none;
            transition: border-color 0.3s;
        }
        .input-field:focus {
            border-color: black;
        }
        .label-text {
            display: block;
            margin-bottom: 0.5rem;
            font-size: 0.875rem;
            font-weight: 600;
            color: #374151;
        }
    </style>
</head>
<body class="antialiased bg-white text-gray-900 flex flex-col min-h-screen">

    <!-- é¡¶éƒ¨å¯¼èˆªæ  (ä¿æŒä¸€è‡´) -->
    <nav class="flex justify-between items-center px-8 md:px-16 py-8 border-b border-gray-100">
        <a href="../index.html" class="text-2xl font-bold tracking-tighter serif">Mock<span class="text-gray-400">.</span>Munchies</a>
        <div class="hidden md:flex space-x-12 text-sm uppercase tracking-widest font-medium items-center">
            <a href="../index.html" class="hover:text-gray-500 transition">è¿”å›é¦–é¡µ</a>
            <a href="#" class="hover:text-gray-500 transition">ç»ƒä¹ ä¸­å¿ƒ</a>
        </div>
    </nav>

    <!-- ä¸»ä½“å†…å®¹ -->
    <main class="flex-grow max-w-4xl mx-auto w-full px-8 py-12">
        
        <div class="text-center mb-12">
            <span class="text-xs uppercase tracking-[0.3em] text-gray-400 font-bold">Preparation</span>
            <h1 class="text-4xl serif mt-4 mb-4">å®Œå–„é¢è¯•ä¿¡æ¯</h1>
            <p class="text-gray-500 font-light">ä¸Šä¼ ç®€å†å¹¶å¡«å†™èŒä½è¯¦æƒ…ï¼Œè®© AI ä¸ºæ‚¨å®šåˆ¶ä¸“å±é¢è¯•ä½“éªŒã€‚</p>
        </div>

        <!-- è¡¨å•åŒºåŸŸ -->
        <div id="formSection" class="space-y-10 animate-fade-in">
            
            <!-- 1. ç®€å†ä¸Šä¼  -->
            <section class="bg-gray-50 p-8 rounded-2xl border border-gray-100">
                <h2 class="text-xl font-bold mb-6 flex items-center">
                    <span class="w-8 h-8 bg-black text-white rounded-full flex items-center justify-center text-sm mr-3">1</span>
                    ä¸Šä¼ ç®€å†
                </h2>
                
                <div class="relative border-2 border-dashed border-gray-300 rounded-xl p-10 text-center hover:bg-gray-50 hover:border-gray-400 transition cursor-pointer group" id="dropZone">
                    <!-- 
                        ä¿®å¤æ–¹æ¡ˆï¼šä½¿ç”¨ç»å¯¹å®šä½çš„é€æ˜ input è¦†ç›–æ•´ä¸ªåŒºåŸŸ
                        1. ç§»é™¤ hidden ç±»ï¼Œæ”¹ç”¨ opacity-0 + absolute inset-0 ç¡®ä¿å¯ç‚¹å‡»
                        2. z-50 ç¡®ä¿ä½äºæœ€ä¸Šå±‚
                        3. åŸç”Ÿ input è´Ÿè´£å¤„ç†ç‚¹å‡»å’Œæ‹–æ‹½ï¼Œæ— éœ€ JS æ¨¡æ‹Ÿ
                    -->
                    <input type="file" id="resumeInput" 
                           class="absolute inset-0 w-full h-full opacity-0 cursor-pointer z-50" 
                           accept=".pdf,.doc,.docx,.jpg,.jpeg,.png,.bmp,.txt"
                           title="ç‚¹å‡»é€‰æ‹©æ–‡ä»¶">
                    
                    <div class="pointer-events-none relative z-10">
                        <div class="text-4xl mb-4 group-hover:scale-110 transition-transform">ğŸ“„</div>
                        <span class="inline-block bg-white border border-gray-200 text-gray-700 px-4 py-2 rounded-lg shadow-sm mb-3 text-sm font-medium group-hover:bg-gray-50 group-hover:border-gray-300">
                            é€‰æ‹©æ–‡ä»¶
                        </span>
                        <p class="font-medium text-lg mb-2 text-gray-600">æˆ–å°†æ–‡ä»¶æ‹–æ‹½è‡³æ­¤å¤„</p>
                        <p class="text-gray-400 text-sm">æ”¯æŒ PDF, DOC, DOCX, JPG, PNG, TXT</p>
                        <p id="fileNameDisplay" class="mt-4 text-blue-600 font-medium hidden"></p>
                    </div>
                </div>
                <p id="uploadError" class="text-red-500 text-sm mt-2 hidden"></p>
            </section>

            <!-- 2. èŒä½ä¿¡æ¯ -->
            <section class="bg-white p-0">
                <h2 class="text-xl font-bold mb-6 flex items-center">
                    <span class="w-8 h-8 bg-black text-white rounded-full flex items-center justify-center text-sm mr-3">2</span>
                    èŒä½è¯¦æƒ…
                </h2>
                
                <!-- <div class="mb-6">
                    <label class="label-text">èŒä½é“¾æ¥ (å¯é€‰)</label>
                    <div class="flex gap-4">
                        <input type="url" id="jobUrl" class="input-field" placeholder="ç²˜è´´èŒä½é¡µé¢ç½‘å€ï¼Œä¾‹å¦‚ï¼šhttps://www.linkedin.com/jobs/...">
                        <button id="analyzeBtn" type="button" class="btn-secondary whitespace-nowrap flex items-center gap-2" onclick="analyzeJobUrl()">
                            <span>âœ¨ AI æ™ºèƒ½åˆ†æ</span>
                        </button>
                    </div>
                    <p class="text-xs text-gray-500 mt-2">ç‚¹å‡»åˆ†æåï¼ŒAI å°†è‡ªåŠ¨æå–èŒä½ä¿¡æ¯å¹¶å¡«å……åˆ°ä¸‹æ–¹ã€‚</p>
                </div> -->

                <div class="grid md:grid-cols-2 gap-6 mb-6">
                    <div>
                        <label class="label-text">å…¬å¸åç§°</label>
                        <input type="text" id="companyName" class="input-field" placeholder="ä¾‹å¦‚ï¼šMunchies Tech">
                    </div>
                    <div>
                        <label class="label-text">èŒä½åç§° <span class="text-red-500">*</span></label>
                        <input type="text" id="position" class="input-field" placeholder="ä¾‹å¦‚ï¼šé«˜çº§å‰ç«¯å·¥ç¨‹å¸ˆ">
                    </div>
                </div>

                <div class="mb-6">
                    <label class="label-text">å…¬å¸ç®€ä»‹</label>
                    <textarea id="companyDesc" rows="3" class="input-field resize-none" placeholder="ç®€å•ä»‹ç»å…¬å¸èƒŒæ™¯..."></textarea>
                </div>

                <div class="mb-6">
                    <label class="label-text">èŒä½æè¿° (JD) <span class="text-red-500">*</span></label>
                    <textarea id="jobDesc" rows="5" class="input-field resize-none" placeholder="è¾“å…¥èŒä½çš„ä¸»è¦èŒè´£..."></textarea>
                </div>

                <div class="mb-6">
                    <label class="label-text">èŒä½è¦æ±‚</label>
                    <textarea id="jobReq" rows="5" class="input-field resize-none" placeholder="è¾“å…¥ä»»èŒèµ„æ ¼è¦æ±‚..."></textarea>
                </div>
            </section>

            <div class="flex justify-end pt-6">
                <button onclick="goToPreview()" class="btn-munchies">ä¸‹ä¸€æ­¥ï¼šé¢„è§ˆä¿¡æ¯ â†’</button>
            </div>
        </div>

        <!-- é¢„è§ˆåŒºåŸŸ (é»˜è®¤éšè—) -->
        <div id="previewSection" class="hidden space-y-8 animate-fade-in">
            <div class="bg-blue-50 border border-blue-100 p-6 rounded-xl flex items-start gap-4">
                <div class="text-blue-500 text-xl">â„¹ï¸</div>
                <div>
                    <h3 class="font-bold text-blue-900 mb-1">éšç§å®‰å…¨æç¤º</h3>
                    <p class="text-blue-800 text-sm leading-relaxed">
                        åœ¨ä¿å­˜ä¹‹å‰ï¼Œè¯·ç¡®ä¿æ‚¨çš„ç®€å†é¢„è§ˆä¸­å·²å»é™¤ <span class="font-bold">å§“åã€ç”µè¯ã€å®¶åº­ä½å€ã€é‚®ç®±åœ°å€</span> ç­‰ä¸ªäººæ•æ„Ÿéšç§ä¿¡æ¯ã€‚
                        è¿™æ˜¯ä¸ºäº†ä¿æŠ¤æ‚¨çš„ä¸ªäººæ•°æ®å®‰å…¨ã€‚
                    </p>
                </div>
            </div>

            <div class="bg-white border border-gray-200 rounded-2xl p-8 shadow-sm">
                <h2 class="text-2xl serif mb-8 border-b pb-4 text-center">ä¿¡æ¯ç¡®è®¤</h2>
                
                <div class="space-y-8">
                    <div class="grid grid-cols-3 gap-4 items-center">
                        <span class="text-gray-500 font-medium text-center">ç®€å†æ–‡ä»¶</span>
                        <div class="col-span-2 font-medium text-center flex justify-center" id="previewResume">æœªä¸Šä¼ </div>
                    </div>
                    
                    <div class="grid grid-cols-3 gap-4 items-center">
                        <span class="text-gray-500 font-medium text-center">å…¬å¸åç§°</span>
                        <div class="col-span-2 text-gray-700 text-center" id="previewCompany">--</div>
                    </div>
                    
                    <div class="grid grid-cols-3 gap-4 items-center">
                        <span class="text-gray-500 font-medium text-center">èŒä½åç§°</span>
                        <div class="col-span-2 text-gray-700 text-center" id="previewPosition">--</div>
                    </div>

                    <div class="grid grid-cols-3 gap-4 items-center">
                        <span class="text-gray-500 font-medium text-center">å…¬å¸ç®€ä»‹</span>
                        <div class="col-span-2 text-gray-700 leading-relaxed text-center" id="previewCompanyDesc">--</div>
                    </div>

                    <div class="grid grid-cols-3 gap-4 items-center">
                        <span class="text-gray-500 font-medium text-center">èŒä½æè¿°</span>
                        <div class="col-span-2 text-gray-700 leading-relaxed whitespace-pre-wrap text-center" id="previewJobDesc">--</div>
                    </div>

                    <div class="grid grid-cols-3 gap-4 items-center">
                        <span class="text-gray-500 font-medium text-center">èŒä½è¦æ±‚</span>
                        <div class="col-span-2 text-gray-700 leading-relaxed whitespace-pre-wrap text-center" id="previewJobReq">--</div>
                    </div>
                </div>
            </div>

            <div class="flex justify-between pt-6">
                <button onclick="backToEdit()" class="btn-secondary">â† è¿”å›ç¼–è¾‘</button>
                <button onclick="saveData()" class="btn-munchies bg-green-600 hover:bg-green-700 border-transparent">ç¡®è®¤ä¿å­˜å¹¶ä¸Šä¼  âœ“</button>
            </div>
        </div>

    </main>

    <!-- Custom Modal -->
    <div id="customModal" class="fixed inset-0 z-[9999] flex items-center justify-center hidden">
        <div class="absolute inset-0 bg-black/50 backdrop-blur-sm" onclick="closeModal()"></div>
        <div class="bg-white rounded-2xl shadow-2xl p-8 max-w-sm w-full mx-4 relative transform transition-all scale-100">
            <div id="modalIcon" class="text-4xl mb-4"></div>
            <h3 id="modalTitle" class="text-xl font-bold mb-2 serif"></h3>
            <div id="modalContent" class="text-gray-600 mb-6 text-sm leading-relaxed whitespace-pre-line"></div>
            <button onclick="closeModal()" class="w-full btn-munchies justify-center">æˆ‘çŸ¥é“äº†</button>
        </div>
    </div>

    <!-- Load Screen Section (Hidden by default, used for processing state) -->
    <div id="loadScreenSection" class="fixed inset-0 z-[10000] bg-white hidden flex-col items-center justify-center overflow-hidden antialiased">
        <div class="fixed inset-0 -z-10 bg-blur-image opacity-10"></div>

        <div class="max-w-xl w-full px-8 text-center">
            <div class="text-xl font-bold tracking-tighter ls-serif mb-16 animate-fau">
                Mock<span class="text-gray-400">.</span>Munchies
            </div>
    
            <div class="mb-4 flex justify-between items-end animate-fau" style="animation-delay: 0.2s;">
                <span class="text-xs uppercase tracking-[0.3em] text-gray-400 font-bold" id="ls-status-text">æ­£åœ¨åˆå§‹åŒ– AI é¢è¯•å®˜</span>
                <span class="text-2xl ls-serif italic text-red-900" id="ls-percent-text">0%</span>
            </div>
    
            <div class="w-full h-[2px] bg-gray-100 mb-12 relative overflow-hidden animate-fau" style="animation-delay: 0.3s;">
                <div id="ls-progress-bar" class="absolute top-0 left-0 h-full bg-black w-0"></div>
            </div>
    
            <div class="h-20 animate-fau" style="animation-delay: 0.5s;">
                <p id="ls-quote-text" class="text-gray-500 text-lg font-light italic leading-relaxed">
                    â€œä¼˜ç§€çš„é¢è¯•ä¸æ˜¯å®Œç¾çš„è¡¨æ¼”ï¼Œè€Œæ˜¯çœŸè¯šçš„æ²Ÿé€šã€‚â€
                </p>
                <p id="ls-sub-quote" class="text-gray-300 text-xs uppercase tracking-widest mt-4 font-medium">
                    â€”â€” èŒåœºç®´è¨€
                </p>
            </div>

            <!-- Click to continue area -->
            <div id="ls-continue-area" class="mt-8 hidden animate-fau">
                <button id="ls-enter-btn" class="btn-munchies bg-red-900 hover:bg-red-800 text-white px-8 py-3 rounded-full shadow-lg transform hover:scale-105 transition-all">
                    ç‚¹å‡»è¿›å…¥é¢è¯•æˆ¿é—´ â†’
                </button>
                <p class="text-gray-400 text-xs mt-3 uppercase tracking-widest">System Ready</p>
            </div>
        </div>
    
        <div class="fixed bottom-12 text-[10px] text-gray-300 uppercase tracking-[0.5em] animate-pulse">
            System Calibrating...
        </div>
    </div>

    <!-- é¡µè„š -->
    <footer class="py-12 border-t border-gray-50 mt-auto">
        <div class="max-w-7xl mx-auto px-8 text-center text-sm text-gray-400 uppercase tracking-widest">
            Â© 2026 Mock Munchies
        </div>
    </footer>

<script>
    // å…è®¸çš„æ–‡ä»¶æ‰©å±•å
    const ALLOWED_EXTENSIONS = ['pdf', 'doc', 'docx', 'jpg', 'jpeg', 'png', 'bmp', 'txt'];

    const resumeInput = document.getElementById('resumeInput');
    const dropZone = document.getElementById('dropZone');
    const fileNameDisplay = document.getElementById('fileNameDisplay');
    const uploadError = document.getElementById('uploadError');

    // åŠ¨æ€è·å–åç«¯ API åœ°å€
    // å¦‚æœæ˜¯é€šè¿‡ file:// åè®®æˆ–é 3000 ç«¯å£ï¼ˆå¦‚ Live Server 5500ï¼‰è®¿é—®ï¼Œåˆ™æŒ‡å‘æœ¬åœ°æœåŠ¡å™¨
    let API_BASE_URL = '';
    if (window.location.protocol === 'file:' || (window.location.port && window.location.port !== '3000')) {
        API_BASE_URL = 'http://localhost:3000';
        console.log('Detected external/local access, setting API_BASE_URL to:', API_BASE_URL);
    }

    let currentResumeFile = null;

    // ç»Ÿä¸€çš„æ–‡ä»¶å¤„ç†å‡½æ•°
    function handleFileSelection(file) {
        uploadError.classList.add('hidden');
        fileNameDisplay.classList.add('hidden');

        if (!file) return;

        console.log('Processing file:', file.name, file.type, file.size);

        const fileExt = file.name.split('.').pop().toLowerCase();
        
        if (!ALLOWED_EXTENSIONS.includes(fileExt)) {
            uploadError.textContent = `æ ¼å¼é”™è¯¯ï¼šä¸æ”¯æŒ .${fileExt} æ ¼å¼ã€‚è¯·ä¸Šä¼  *.pdf;*.doc;*.docx;*.jpg;*.jpeg;*.png;*.bmp;*.txtæ ¼å¼ã€‚`;
            uploadError.classList.remove('hidden');
            // æ¸…ç©ºå½“å‰æ–‡ä»¶
            currentResumeFile = null;
            resumeInput.value = ''; 
            console.log('File upload failed: Invalid format', file.name);
            return;
        }

        // ä¿å­˜æ–‡ä»¶å¼•ç”¨
        currentResumeFile = file;

        // ä¸Šä¼ æˆåŠŸé€»è¾‘
        fileNameDisplay.textContent = `å·²é€‰æ‹©æ–‡ä»¶: ${file.name} (${(file.size / 1024).toFixed(1)} KB)`;
        fileNameDisplay.classList.remove('hidden');
        
        console.log('--- Resume Uploaded ---');
        console.log('File Name:', file.name);
        console.log('File Size:', file.size, 'bytes');
        console.log('File Type:', file.type);
        console.log('-----------------------');
    }

    // æ‹–æ‹½è§†è§‰åé¦ˆ (ç›‘å¬ input ä¸Šçš„äº‹ä»¶ï¼Œå› ä¸º input è¦†ç›–äº† dropZone)
    resumeInput.addEventListener('dragover', (e) => {
        e.preventDefault();
        dropZone.classList.add('border-black', 'bg-gray-50');
    });

    resumeInput.addEventListener('dragleave', (e) => {
        e.preventDefault();
        dropZone.classList.remove('border-black', 'bg-gray-50');
    });

    resumeInput.addEventListener('drop', (e) => {
        e.preventDefault();
        dropZone.classList.remove('border-black', 'bg-gray-50');
        
        console.log('File dropped');
        if (e.dataTransfer.files.length > 0) {
            // ç›´æ¥å¤„ç†æ–‡ä»¶ï¼Œä¸ä¾èµ– input.files èµ‹å€¼ (è™½ç„¶å°è¯•èµ‹å€¼ä»¥ä¿æŒåŒæ­¥)
            try {
                resumeInput.files = e.dataTransfer.files;
            } catch (err) {
                console.warn('Failed to set input.files property (browser restriction), utilizing global variable fallback.', err);
            }
            handleFileSelection(e.dataTransfer.files[0]);
        }
    });

    // ç›‘å¬æ–‡ä»¶ä¸Šä¼  (ç‚¹å‡»é€‰æ‹©)
    // ä¼˜åŒ–ï¼šå…è®¸é‡å¤é€‰æ‹©åŒä¸€æ–‡ä»¶ï¼Œå¹¶é˜²æ­¢äº‹ä»¶å†’æ³¡å¯¼è‡´çš„æ­»å¾ªç¯
    resumeInput.addEventListener('click', function(e) {
        e.stopPropagation(); // å…³é”®ï¼šé˜»æ­¢å†’æ³¡ï¼Œé˜²æ­¢è§¦å‘ dropZone çš„ç‚¹å‡»äº‹ä»¶
        this.value = null;   // å…³é”®ï¼šæ¸…ç©º valueï¼Œå…è®¸é‡å¤é€‰æ‹©åŒä¸€æ–‡ä»¶
        console.log('Resume input clicked');
    });

    resumeInput.addEventListener('change', function(e) {
        console.log('Input change event fired');
        handleFileSelection(e.target.files[0]);
    });

    // å¤‡ä»½äº¤äº’é€»è¾‘ï¼šå¦‚æœç”¨æˆ·ç‚¹å‡»äº† dropZone ä½†æ²¡ç‚¹åˆ° input (è™½ç„¶ input è¦†ç›–äº†å…¨å±ï¼Œä½†åœ¨æŸäº›æç«¯å¸ƒå±€ä¸‹å¯èƒ½å¤±æ•ˆ)
    // åˆ™æ‰‹åŠ¨è§¦å‘ input çš„ç‚¹å‡»
    dropZone.addEventListener('click', function() {
        console.log('DropZone clicked, triggering input click');
        resumeInput.click();
    });

    // AI æ™ºèƒ½åˆ†æèŒä½é“¾æ¥
    async function analyzeJobUrl() {
        const urlInput = document.getElementById('jobUrl');
        const analyzeBtn = document.getElementById('analyzeBtn');
        const url = urlInput.value.trim();

        if (!url) {
            showModal('æç¤º', 'è¯·å…ˆè¾“å…¥èŒä½é¡µé¢çš„ç½‘å€ã€‚', 'error');
            return;
        }

        // Set loading state
        const originalBtnText = analyzeBtn.innerHTML;
        analyzeBtn.innerHTML = '<span>â³ åˆ†æä¸­...</span>';
        analyzeBtn.disabled = true;
        analyzeBtn.classList.add('opacity-50', 'cursor-not-allowed');

        try {
            console.log('[Analyze URL] Sending request:', url);
            const response = await fetch(`${API_BASE_URL}/api/analyze-url`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ url })
            });

            if (!response.ok) {
                const errorData = await response.json();
                throw new Error(errorData.details || errorData.error || 'åˆ†æå¤±è´¥');
            }

            const data = await response.json();
            console.log('[Analyze URL] Success:', data);

            // Populate fields
            if (data.companyName) document.getElementById('companyName').value = data.companyName;
            if (data.positionName) document.getElementById('position').value = data.positionName;
            if (data.companyDescription) document.getElementById('companyDesc').value = data.companyDescription;
            if (data.jobDescription) document.getElementById('jobDesc').value = data.jobDescription;
            if (data.jobRequirements) document.getElementById('jobReq').value = data.jobRequirements;

            showModal('åˆ†ææˆåŠŸ', 'AI å·²è‡ªåŠ¨æå–èŒä½ä¿¡æ¯å¹¶å¡«å……åˆ°è¡¨å•ä¸­ã€‚è¯·æ£€æŸ¥å¹¶ç¡®è®¤ã€‚', 'success');

        } catch (error) {
            console.error('[Analyze URL] Error:', error);
            showModal('åˆ†æå¤±è´¥', `æ— æ³•ä»è¯¥ç½‘å€æå–ä¿¡æ¯ã€‚\nåŸå› ï¼š${error.message}\nè¯·æ£€æŸ¥ç½‘å€æ˜¯å¦æ­£ç¡®æˆ–æ‰‹åŠ¨å¡«å†™ã€‚`, 'error');
        } finally {
            // Restore button state
            analyzeBtn.innerHTML = originalBtnText;
            analyzeBtn.disabled = false;
            analyzeBtn.classList.remove('opacity-50', 'cursor-not-allowed');
        }
    }

    // åˆ‡æ¢åˆ°é¢„è§ˆé¡µ
    async function goToPreview() {
        console.log('goToPreview called');
        try {
            // è·å–å€¼
            const companyName = document.getElementById('companyName').value.trim();
            const companyDesc = document.getElementById('companyDesc').value.trim();
            const position = document.getElementById('position').value.trim();
            const jobDesc = document.getElementById('jobDesc').value.trim();
            const jobReq = document.getElementById('jobReq').value.trim();
            
            // ä½¿ç”¨å…¨å±€å˜é‡ currentResumeFileï¼Œæ¯” resumeInput.files[0] æ›´å¯é 
            // æ·»åŠ å›é€€æœºåˆ¶ï¼šå¦‚æœå…¨å±€å˜é‡ä¸ºç©ºï¼Œå°è¯•ç›´æ¥ä» input è·å–
            const file = currentResumeFile || (resumeInput.files && resumeInput.files[0]);
            console.log('Preview check - File:', file ? file.name : 'None', 'Position:', position, 'JobDesc:', jobDesc);

            // å¿…å¡«é¡¹éªŒè¯
            let errors = [];
            if (!file) errors.push('â€¢ è¯·ä¸Šä¼ ç®€å†æ–‡ä»¶');
            if (!position) errors.push('â€¢ è¯·å¡«å†™èŒä½åç§°');
            if (!jobDesc) errors.push('â€¢ è¯·å¡«å†™èŒä½æè¿°');

            if (errors.length > 0) {
                console.warn('Validation failed:', errors);
                showModal('è¯·è¡¥å……å¿…å¡«é¡¹', errors.join('\n'), 'error');
                return;
            }

            // åˆ‡æ¢æ˜¾ç¤º (å…ˆåˆ‡æ¢ä»¥å±•ç¤ºåŠ è½½çŠ¶æ€)
            const formSection = document.getElementById('formSection');
            const previewSection = document.getElementById('previewSection');
            
            if (formSection && previewSection) {
                formSection.classList.add('hidden');
                previewSection.classList.remove('hidden');
                window.scrollTo(0, 0);
            } else {
                console.error('Section elements not found');
                return;
            }
            
            document.getElementById('previewCompany').textContent = companyName || 'æœªå¡«å†™';
            document.getElementById('previewCompanyDesc').textContent = companyDesc || 'æœªå¡«å†™';
            document.getElementById('previewPosition').textContent = position || 'æœªå¡«å†™';
            document.getElementById('previewJobDesc').textContent = jobDesc || 'æœªå¡«å†™';
            document.getElementById('previewJobReq').textContent = jobReq || 'æœªå¡«å†™';

            // å¡«å……é¢„è§ˆ
            const previewContainer = document.getElementById('previewResume');
            if (!previewContainer) return;

            previewContainer.innerHTML = '<p class="text-gray-400 text-sm animate-pulse">æ­£åœ¨åŠ è½½é¢„è§ˆ...</p>'; 
            previewContainer.className = 'col-span-2 font-medium text-center flex justify-center'; 

            if (!file) {
                // Should be caught by validation, but just in case
                previewContainer.textContent = 'æœªä¸Šä¼ ';
                previewContainer.classList.add('text-red-500');
            } else {
                const fileExt = file.name.split('.').pop().toLowerCase();
                
                try {
                    if (['jpg', 'jpeg', 'png', 'bmp'].includes(fileExt)) {
                        const img = document.createElement('img');
                        img.src = URL.createObjectURL(file);
                        img.className = 'max-w-full h-auto max-h-96 object-contain border rounded-lg shadow-sm';
                        previewContainer.innerHTML = '';
                        previewContainer.appendChild(img);
                    } else if (fileExt === 'pdf') {
                        const iframe = document.createElement('iframe');
                        iframe.src = URL.createObjectURL(file);
                        iframe.className = 'w-full h-96 border rounded-lg bg-gray-50 shadow-sm';
                        previewContainer.innerHTML = '';
                        previewContainer.appendChild(iframe);
                    } else if (fileExt === 'txt') {
                        const text = await file.text();
                        const pre = document.createElement('pre');
                        pre.className = 'whitespace-pre-wrap font-mono text-sm bg-gray-50 p-4 rounded-lg max-h-96 overflow-y-auto border shadow-sm';
                        pre.textContent = text;
                        previewContainer.innerHTML = '';
                        previewContainer.appendChild(pre);
                    } else if (fileExt === 'docx') {
                        const arrayBuffer = await file.arrayBuffer();
                        const result = await mammoth.convertToHtml({arrayBuffer: arrayBuffer});
                        const div = document.createElement('div');
                        div.className = 'prose prose-sm max-w-none bg-white p-4 rounded-lg max-h-96 overflow-y-auto border shadow-sm';
                        div.innerHTML = result.value;
                        previewContainer.innerHTML = '';
                        previewContainer.appendChild(div);
                    } else {
                        // DOC æˆ–å…¶ä»–
                        previewContainer.innerHTML = `
                            <div class="flex items-center space-x-3 text-gray-500 bg-gray-50 p-4 rounded-lg border">
                                <span class="text-2xl">ğŸ“„</span>
                                <div>
                                    <p class="font-medium text-gray-900">${file.name}</p>
                                    <p class="text-xs mt-1">è¯¥æ ¼å¼ (.${fileExt}) æš‚ä¸æ”¯æŒåœ¨çº¿å†…å®¹é¢„è§ˆï¼Œè¯·ç¡®ä¿æ–‡ä»¶æ— è¯¯ã€‚</p>
                                </div>
                            </div>
                        `;
                    }
                } catch (e) {
                    console.error('Preview error:', e);
                    previewContainer.innerHTML = `
                        <p class="text-red-500 text-sm">
                            é¢„è§ˆç”Ÿæˆå¤±è´¥: ${e.message}<br>
                            <span class="text-gray-400 text-xs">æ–‡ä»¶å·²é€‰ä¸­ (${file.name})ï¼Œå¯ç»§ç»­ä¿å­˜ã€‚</span>
                        </p>
                    `;
                }
            }
        } catch (err) {
            console.error('Critical error in goToPreview:', err);
            showModal('ç³»ç»Ÿé”™è¯¯', 'æ— æ³•è·³è½¬åˆ°é¢„è§ˆé¡µé¢ï¼Œè¯·åˆ·æ–°åé‡è¯•ã€‚\n' + err.message, 'error');
        }
    }

    // è¿”å›ç¼–è¾‘
    function backToEdit() {
        document.getElementById('previewSection').classList.add('hidden');
        document.getElementById('formSection').classList.remove('hidden');
        window.scrollTo(0, 0);
    }

    // æ˜¾ç¤ºæ¨¡æ€æ¡†
    let modalOnCloseCallback = null;

    function showModal(title, content, type = 'info', onClose = null) {
        const modal = document.getElementById('customModal');
        const icon = document.getElementById('modalIcon');
        const titleEl = document.getElementById('modalTitle');
        const contentEl = document.getElementById('modalContent');
        
        modalOnCloseCallback = onClose;

        // è®¾ç½®å†…å®¹
        titleEl.textContent = title;
        contentEl.textContent = content;
        
        // è®¾ç½®å›¾æ ‡
        if (type === 'success') {
            icon.textContent = 'ğŸ‰';
        } else if (type === 'error') {
            icon.textContent = 'âš ï¸';
        } else {
            icon.textContent = 'â„¹ï¸';
        }

        // æ˜¾ç¤º
        modal.classList.remove('hidden');
        document.body.style.overflow = 'hidden'; // ç¦æ­¢èƒŒæ™¯æ»šåŠ¨
    }

    // å…³é—­æ¨¡æ€æ¡†
    function closeModal() {
        const modal = document.getElementById('customModal');
        modal.classList.add('hidden');
        document.body.style.overflow = ''; // æ¢å¤æ»šåŠ¨
        
        if (modalOnCloseCallback) {
            modalOnCloseCallback();
            modalOnCloseCallback = null;
        }
    }

    // å¤„ç† PDF ArrayBuffer çš„é€šç”¨å‡½æ•°
    async function processPdfBuffer(arrayBuffer) {
        try {
            const pdf = await pdfjsLib.getDocument({data: arrayBuffer}).promise;
            let fullText = '';
            const maxPages = Math.min(pdf.numPages, 5);
            
            // åˆå§‹åŒ– OCR Worker (å¤ç”¨)
            let worker = null;

            for (let i = 1; i <= maxPages; i++) {
                const page = await pdf.getPage(i);
                
                // 1. è·å–å¸¸è§„æ–‡æœ¬
                const textContent = await page.getTextContent();
                const pageText = textContent.items.map(item => item.str).join(' ');
                fullText += `[Page ${i} Text]\n${pageText}\n\n`;

                // 2. æ£€æŸ¥å¹¶æå–å›¾ç‰‡ (OCR)
                try {
                    const ops = await page.getOperatorList();
                    const imgTypes = [pdfjsLib.OPS.paintImageXObject, pdfjsLib.OPS.paintInlineImageXObject];
                    
                    let hasImages = false;
                    for (let j = 0; j < ops.fn.length; j++) {
                        if (imgTypes.includes(ops.fn[j])) {
                            hasImages = true;
                            break;
                        }
                    }

                    if (hasImages) {
                        // å¦‚æœè¿™ä¸€é¡µæœ‰å›¾ç‰‡ï¼Œä¸”æ–‡å­—å¾ˆå°‘(å¯èƒ½æ˜¯æ‰«æä»¶)ï¼Œæˆ–è€…ä¸ºäº†ä¿é™©èµ·è§ï¼Œ
                        // æˆ‘ä»¬æ¸²æŸ“æ•´ä¸ªé¡µé¢åˆ° Canvas è¿›è¡Œ OCRã€‚
                        // ç›´æ¥æå– image object æ¯”è¾ƒå¤æ‚ï¼Œæ¸²æŸ“é¡µé¢æ˜¯æ›´é€šç”¨çš„åšæ³•ã€‚
                        
                        // ç®€å•çš„å¯å‘å¼ï¼šå¦‚æœé¡µé¢æ–‡å­—å°‘äº 100 å­—ï¼Œæå¯èƒ½æ˜¯æ‰«æä»¶æˆ–å›¾ç‰‡ä¸ºä¸»
                        if (pageText.trim().length < 100) {
                            if (!worker) {
                                showModal('æ­£åœ¨è¿›è¡Œæ·±åº¦è¯†åˆ«', 'æ£€æµ‹åˆ° PDF ä¸­åŒ…å«å›¾ç‰‡æˆ–æ‰«æå†…å®¹ï¼Œæ­£åœ¨è¿›è¡Œ OCR è¯†åˆ«...', 'info');
                                worker = await Tesseract.createWorker('chi_sim+eng');
                            }

                            const viewport = page.getViewport({scale: 1.5});
                            const canvas = document.createElement('canvas');
                            const ctx = canvas.getContext('2d');
                            canvas.height = viewport.height;
                            canvas.width = viewport.width;

                            await page.render({canvasContext: ctx, viewport: viewport}).promise;
                            
                            const ret = await worker.recognize(canvas);
                            if (ret.data.text.trim()) {
                                fullText += `[Page ${i} OCR Result]\n${ret.data.text}\n\n`;
                            }
                        }
                    }
                } catch (imgErr) {
                    console.warn(`Page ${i} image processing failed:`, imgErr);
                }
            }

            if (worker) {
                await worker.terminate();
            }

            if (pdf.numPages > 5) fullText += `\n... (å‰©ä½™ ${pdf.numPages - 5} é¡µæœªå±•ç¤º)`;
            return fullText;
        } catch (e) {
            console.error('PDF processing error:', e);
            return `[PDF è§£æé”™è¯¯: ${e.message}]`;
        }
    }

    // è§£ææ–‡ä»¶å†…å®¹è¾…åŠ©å‡½æ•°
    async function extractFileText(file) {
        const ext = file.name.split('.').pop().toLowerCase();
        try {
            if (ext === 'txt') {
                return await file.text();
            } else if (ext === 'docx') {
                // 1. è·å–å¸¸è§„æ–‡æœ¬
                const arrayBuffer = await file.arrayBuffer();
                const rawResult = await mammoth.extractRawText({arrayBuffer: arrayBuffer});
                let finalText = rawResult.value;

                // 2. å°è¯•æå–åµŒå…¥çš„å›¾ç‰‡å¹¶ OCR
                try {
                    const htmlResult = await mammoth.convertToHtml({arrayBuffer: arrayBuffer});
                    const parser = new DOMParser();
                    const doc = parser.parseFromString(htmlResult.value, 'text/html');
                    const images = doc.querySelectorAll('img');

                    if (images.length > 0) {
                        showModal('æ­£åœ¨æ·±å…¥åˆ†æ', `æ£€æµ‹åˆ°æ–‡æ¡£ä¸­åŒ…å« ${images.length} å¼ å›¾ç‰‡ï¼Œæ­£åœ¨è¿›è¡Œ OCR æ–‡å­—è¯†åˆ«...`, 'info');
                        const worker = await Tesseract.createWorker('chi_sim+eng');
                        
                        let imageOcrText = '';
                        for (let i = 0; i < images.length; i++) {
                            const imgSrc = images[i].src;
                            if (imgSrc.startsWith('data:image')) {
                                try {
                                    const ret = await worker.recognize(imgSrc);
                                    if (ret.data.text.trim()) {
                                        imageOcrText += `\n[æ–‡æ¡£åµŒå…¥å›¾ç‰‡ ${i+1} OCR]:\n${ret.data.text}\n`;
                                    }
                                } catch (ocrErr) {
                                    console.warn('Embedded image OCR failed:', ocrErr);
                                }
                            }
                        }
                        await worker.terminate();

                        if (imageOcrText) {
                            finalText += '\n\n--- åµŒå…¥å›¾ç‰‡ OCR è¡¥å……å†…å®¹ ---\n' + imageOcrText;
                        }
                    }
                } catch (imgErr) {
                    console.warn('DOCX image extraction failed:', imgErr);
                }

                // 3. å°è¯•æå–åµŒå…¥çš„ PDF æ–‡ä»¶
                try {
                    const zip = await JSZip.loadAsync(file);
                    const pdfFiles = [];
                    zip.forEach((relativePath, zipEntry) => {
                        if (relativePath.toLowerCase().endsWith('.pdf')) {
                            pdfFiles.push(zipEntry);
                        }
                    });

                    if (pdfFiles.length > 0) {
                        showModal('æ­£åœ¨æ·±å…¥åˆ†æ', `æ£€æµ‹åˆ°æ–‡æ¡£ä¸­åµŒå…¥äº† ${pdfFiles.length} ä¸ª PDF æ–‡ä»¶ï¼Œæ­£åœ¨è§£æ...`, 'info');
                        let pdfText = '';
                        for (let i = 0; i < pdfFiles.length; i++) {
                            const pdfData = await pdfFiles[i].async('arraybuffer');
                            const extracted = await processPdfBuffer(pdfData);
                            pdfText += `\n[æ–‡æ¡£åµŒå…¥ PDF ${i+1} å†…å®¹]:\n${extracted}\n`;
                        }
                        finalText += '\n\n--- åµŒå…¥ PDF è¡¥å……å†…å®¹ ---\n' + pdfText;
                    }
                } catch (zipErr) {
                    console.warn('DOCX embedded PDF extraction failed:', zipErr);
                }

                return finalText;
            } else if (ext === 'pdf') {
                const arrayBuffer = await file.arrayBuffer();
                return await processPdfBuffer(arrayBuffer);
            } else if (['jpg', 'jpeg', 'png', 'bmp'].includes(ext)) {
                showModal('æ­£åœ¨è¿›è¡Œ OCR è¯†åˆ«', 'æ­£åœ¨è¯†åˆ«å›¾ç‰‡ä¸­çš„æ–‡å­—ï¼Œè¿™å¯èƒ½éœ€è¦ä¸€ç‚¹æ—¶é—´ï¼Œè¯·è€å¿ƒç­‰å¾…...', 'info');
                const worker = await Tesseract.createWorker('chi_sim+eng');
                const ret = await worker.recognize(file);
                await worker.terminate();
                // è¯†åˆ«å®Œæˆåé‡æ–°æ˜¾ç¤ºåŸæœ¬çš„"å¤„ç†ä¸­"å¼¹çª—ï¼Œæˆ–è€…ä¿æŒç›´åˆ°å®Œæˆ
                return `[OCR è¯†åˆ«ç»“æœ]\n${ret.data.text}`;
            } else if (ext === 'doc') {
                return `[DOC æ ¼å¼æç¤º] æš‚ä¸æ”¯æŒç›´æ¥åœ¨æµè§ˆå™¨ç«¯è§£æ .doc (äºŒè¿›åˆ¶ Word) æ ¼å¼ã€‚è¯·å°†å…¶å¦å­˜ä¸º .docx æˆ– .pdf åä¸Šä¼ ä»¥è·å–æœ€ä½³ä½“éªŒã€‚`;
            } else {
                return `[è¯¥æ ¼å¼ (.${ext}) æš‚ä¸æ”¯æŒæ–‡æœ¬æå–]`;
            }
        } catch (e) {
            console.error('Text extraction error:', e);
            return `[å†…å®¹è§£æå¤±è´¥: ${e.message}]`;
        }
    }

    // ä¿å­˜æ•°æ®
    async function saveData() {
        const position = document.getElementById('position').value.trim();
        const jobDesc = document.getElementById('jobDesc').value.trim();
        // ä½¿ç”¨å…¨å±€å˜é‡ currentResumeFile (å¸¦å›é€€)
        const file = currentResumeFile || (resumeInput.files && resumeInput.files[0]);

        // å¿…å¡«é¡¹éªŒè¯
        let errors = [];
        if (!file) errors.push('â€¢ è¯·ä¸Šä¼ ç®€å†æ–‡ä»¶');
        if (!position) errors.push('â€¢ è¯·å¡«å†™èŒä½åç§°');
        if (!jobDesc) errors.push('â€¢ è¯·å¡«å†™èŒä½æè¿°');

        if (errors.length > 0) {
            showModal('è¯·è¡¥å……å¿…å¡«é¡¹', errors.join('\n'), 'error');
            return;
        }

        // æ˜¾ç¤ºæ­£åœ¨å¤„ç† (åˆ‡æ¢åˆ° Load Screen)
        // showModal('æ­£åœ¨å¤„ç†', 'æ­£åœ¨è§£ææ–‡ä»¶å¹¶æ‰“åŒ…æ•°æ®ï¼Œè¯·ç¨å€™...', 'info');
        activateLoadScreen();

        // æå–æ–‡ä»¶å†…å®¹
        // å¢åŠ äººä¸ºå»¶è¿Ÿï¼Œç¡®ä¿åŠ¨ç”»æµç•…å±•ç¤º (æ§åˆ¶åœ¨ 3-5 ç§’ä¹‹é—´)
        const minDuration = 3000;
        const maxDuration = 5000;
        const randomDuration = Math.floor(Math.random() * (maxDuration - minDuration + 1)) + minDuration;
        const delayPromise = new Promise(resolve => setTimeout(resolve, randomDuration));
        
        let fileContent = '';
        try {
             fileContent = await extractFileText(file);
             updateLoadScreenProgress(40, "æ­£åœ¨ç”Ÿæˆè¡Œä¸šæ ¸å¿ƒè€ƒç‚¹...");
        } catch (err) {
            console.error(err);
            // è¿™é‡Œå¯ä»¥å¤„ç†é”™è¯¯ï¼Œæš‚æ—¶å¿½ç•¥ï¼Œä¼šåœ¨ prompt ç”Ÿæˆæ­¥éª¤æŠ¥é”™
        }

        await delayPromise;

        // æ¨¡æ‹Ÿä¿å­˜
        const formData = {
            resume: file.name,
            company: document.getElementById('companyName').value.trim(),
            companyDescription: document.getElementById('companyDesc').value.trim(),
            position: position,
            jobDescription: jobDesc,
            jobRequirements: document.getElementById('jobReq').value.trim()
        };

        updateLoadScreenProgress(70, "æ­£åœ¨é…ç½®é¢è¯•å®éªŒå®¤...");

        console.log('%câœ… ä¿å­˜æˆåŠŸ - æ•°æ®è¯¦æƒ…:', 'color: green; font-weight: bold; font-size: 14px;');
        // ... (logs removed for brevity) ...

        try {
            // è°ƒç”¨åç«¯ API ç”Ÿæˆ System Prompt
            const response = await fetch(`${API_BASE_URL}/api/generate-prompt`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    fileContent,
                    formData
                })
            });

            if (!response.ok) {
                let errorDetails = 'Unknown error';
                try {
                    const errData = await response.json();
                    errorDetails = errData.error || errData.message || JSON.stringify(errData);
                } catch (e) {
                    errorDetails = response.statusText;
                }
                throw new Error(`Server Error (${response.status}): ${errorDetails}`);
            }

            const data = await response.json();
            const systemPrompt = data.systemPrompt;

            updateLoadScreenProgress(100, "AI åŠ©æ‰‹å·²å°±ç»ª...");

            // ä¿å­˜ Prompt åˆ° localStorage ä¾› interview_page.html ä½¿ç”¨
            localStorage.setItem('interview_system_prompt', systemPrompt);
            // ä¿å­˜ç”¨æˆ·ç®€å†æ•°æ®ä»¥å¤‡ä¸æ—¶ä¹‹éœ€
            localStorage.setItem('interview_user_data', JSON.stringify(formData));

            // æ¸…é™¤æ—§çš„å¯¹è¯å†å²ï¼Œç¡®ä¿å¼€å§‹æ–°çš„é¢è¯•ä¼šè¯
            localStorage.removeItem('mock_interview_history');

            // å®Œæˆï¼Œæ˜¾ç¤ºç‚¹å‡»è¿›å…¥
            showEnterButton();

        } catch (error) {
            console.error('Error in prompt generation:', error);
            // å¦‚æœå‡ºé”™ï¼Œéšè— Load Screenï¼Œæ˜¾ç¤ºé”™è¯¯ Modal
            document.getElementById('loadScreenSection').classList.add('hidden');
            document.body.style.overflow = '';
            showModal('ä¿å­˜å¤±è´¥', 'ç”Ÿæˆé¢è¯•æ•°æ®æ—¶å‡ºé”™ï¼Œè¯·é‡è¯•ã€‚\n' + error.message, 'error');
        }
    }

    // Load Screen Logic
    const lsQuotes = [
        { text: "â€œæ¯ä¸€ä¸ªé—®é¢˜éƒ½æ˜¯å±•ç¤ºä½ é€»è¾‘æ€ç»´çš„æœºä¼šã€‚â€", sub: "é¢è¯•æŠ€å·§" },
        { text: "â€œä¸è¦å®³æ€•æ²‰é»˜ï¼Œæ€è€ƒè¿‡åçš„å›ç­”æ›´æœ‰åˆ†é‡ã€‚â€", sub: "èŒåœºå¿ƒç†" },
        { text: "â€œç®€å†å†³å®šäº†ä½ çš„ä¸‹é™ï¼Œè€Œè¡¨è¾¾å†³å®šäº†ä½ çš„ä¸Šé™ã€‚â€", sub: "èŒä¸šè¿›é˜¶" },
        { text: "â€œJava å¼€å‘è€…ä¸ä»…æ˜¯åœ¨å†™ä»£ç ï¼Œæ›´æ˜¯åœ¨æ„å»ºè§£å†³é—®é¢˜çš„æ¶æ„ã€‚â€", sub: "æŠ€æœ¯æ´å¯Ÿ" },
        { text: "â€œäº§å“ç»ç†çš„å†…æ ¸ï¼Œæ˜¯å¯¹æ‰‹æ„Ÿä¸æ•°æ®çš„åŒé‡å°Šé‡ã€‚â€", sub: "è¡Œä¸šæ€è€ƒ" },
        { text: "â€œè‡ªä¿¡ä¸æ˜¯å› ä¸ºä½ æ— æ‰€ä¸çŸ¥ï¼Œè€Œæ˜¯å› ä¸ºä½ æ— æ‰€ç•æƒ§ã€‚â€", sub: "å¿ƒæ€å»ºè®¾" }
    ];

    function activateLoadScreen() {
        const ls = document.getElementById('loadScreenSection');
        ls.classList.remove('hidden');
        ls.classList.add('flex');
        document.body.style.overflow = 'hidden'; // ç¦æ­¢æ»šåŠ¨
        
        // Reset state
        updateLoadScreenProgress(5, "æ­£åœ¨åŠ è½½å²—ä½æ¨¡å‹...");
        document.getElementById('ls-continue-area').classList.add('hidden');
        
        // Random quote
        const randomQ = lsQuotes[Math.floor(Math.random() * lsQuotes.length)];
        document.getElementById('ls-quote-text').innerText = randomQ.text;
        document.getElementById('ls-sub-quote').innerText = "â€”â€” " + randomQ.sub;
    }

    function updateLoadScreenProgress(percent, statusMsg) {
        document.getElementById('ls-progress-bar').style.width = percent + '%';
        document.getElementById('ls-percent-text').innerText = percent + '%';
        if (statusMsg) {
            document.getElementById('ls-status-text').innerText = statusMsg;
        }
    }

    function showEnterButton() {
        const continueArea = document.getElementById('ls-continue-area');
        continueArea.classList.remove('hidden');
        
        // ç»‘å®šç‚¹å‡»äº‹ä»¶
        const enterBtn = document.getElementById('ls-enter-btn');
        const handler = () => {
             window.location.href = '../interview_page/interview_page.html';
        };
        
        enterBtn.onclick = handler;
        
        // ç»‘å®šä»»æ„é”®
        const keyHandler = (e) => {
            window.location.href = '../interview_page/interview_page.html';
            document.removeEventListener('keydown', keyHandler);
        };
        document.addEventListener('keydown', keyHandler);
    }

</script>
</body>
</html>